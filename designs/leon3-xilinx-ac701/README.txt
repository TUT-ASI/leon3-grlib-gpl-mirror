This leon3 design is tailored to the Xilinx Artix-7 AC701 board
---------------------------------------------------------------

NOTE: The SGMII Ethernet interface does currently NOT work on this
design.

http://www.xilinx.com/ac701

Note: This design requires that the GRLIB_SIMULATOR variable is
correctly set. Please refer to the documentation in doc/grlib.pdf for
additional information.

Note: The Vivado flow and parts of this design are still
experimental. Currently the design configuration should be left as-is.

Note: You must have both Vivado 2013.3 and Xilinx ISE 14.6 in your
path for the make targets to work.

Simulation and synthesis
------------------------

The design uses the Xilinx MIG memory interface with an AHB-2.0
interface. The MIG source code cannot be distributed due to the
prohibitive Xilinx license, so the MIG must be re-generated with 
coregen before simulation and synthesis can be done.

Xilinx MIG interface will automatically be generated when 
Vivado is launched  

To simulate using XSIM and run systest.c on the Leon design using the memory 
controller from Xilinx use the make targets:

  make vivado-launch

To simulate using Modelsim and run systest.c on the Leon design using 
the memory controller from Xilinx use the make targets:

  make vsim (only required if Modelsim/Aldec is used as simulator)
  make mig_series7
  make vsim-launch

To simulate using Aldec Riviera use the following make targets:

  make riviera
  make mig_series7
  make riviera-launch

To synthesize the design, do

  make vivado

and then use iMPACT programming tool:
  
  make ise-prog-fpga

to program the FPGA.

After successfully programmed the FPGA using the target 'ise-prog-fpga' user might 
have to press the 'EAST' button in order to successfully complete the calibration
process in the MIG. Led 1 and led 2 should be constant green if the Calibration 
process has been successful.

If user tries to connect to the board and the MIG has not been calibrated successfully
'grmon' will output:

$ grmon -xilusb -u -nb
  
  GRMON2 LEON debug monitor v2.0.43-2-g95d293c internal version
  
  Copyright (C) 2013 Aeroflex Gaisler - All rights reserved.
  For latest updates, go to http://www.gaisler.com/
  Comments or bug-reports to support@gaisler.com
  
Parsing -xilusb
Parsing -u
Parsing -nb

Commands missing help:
 datacache

Xilusb: Cable type/rev : 0x3
 JTAG chain (1):
xc7k325t

AMBA plug&play not found!
Failed to initialize target!
Exiting GRMON

The MIG and SGMII IP can be disabled either by deselecting the memory
controller and Gaisler Ethernet interface in 'xconfig' or manually
editing the config.vhd file.  When no MIG and no SGMII block is
present in the system normal GRLIB flow can be used and no extra
compile steps are needed. Also when when no MIG is present it is
possible to control and set the system frequency via xconfig.  Note
that the system frequency can be modified via Vivado when the MIG is
present by modifying within specified limits for the MIG IP.

Compiling and launching modelsim when no memory controller and no
ethernet interface is present using Modelsim/Aldec simulator:

  make vsim
  make vsim-launch

Simulation options
------------------

All options are set either by editing the testbench or specify/modify the generic 
default value when launching the simulator. For Modelsim use the option "-g" i.e.
to enable processor disassembly to console launch modelsim with the option: "-gdisas=1"

USE_MIG_INTERFACE_MODEL - Use MIG simulation model for faster simulation run time
(Option can now be controlled via 'make xconfig')

disas - Enable processor disassembly to console

Design specifics
----------------

* The DDR3 controller is implemented with Xilinx MIG Series7 2.0 and 
  runs of the 200 MHz clock. The DDR3 memory runs at 400 MHz
  (DDR3-800). grmon-2.0.30-74 or later is needed to detect the
   DDR3 memory.

* The AHB clock is generated by the MMCM module in the DDR3
  controller, and can be controlled via Coregen. When the 
  MIG DDR3 controller isn't present the AHB clock is generated
  from CLKGEN, and can be controlled via xconfig

* System reset is mapped to the EAST button
  (This is since the CPU RESET button pin is used for DDR VTP)

* DSU break is mapped to GPIO east button

* LED 0 indicates processor in debug mode

* LED 1 indicates processor in error mode, execution halted

* LED 2 indicates DDR3 PHY initialization done (Only valid when MIG is present)

* LED 3 indicates internal PLL has locked (Only valid when MIG isn't present)

* 16-bit flash prom can be read at address 0. It can be programmed
  with GRMON version 2.0.30-74 or later.

* The system can be simulated with xilinxs memory interface in normal or fast mode.
  For normal mode i.e. with the MIG IP and Memory models from MICRON all simulaion libraries
  needs to be installed and compiled with the following command: Please, note the MIG Series7 
  only have to be generated if it is going to be used in the system.

  make vsim
  make mig_series7

  Then rebuild the software and launch the simulator simulation:

  make soft
  make vsim-launch

  Modelsim v10.1 or newer is required and simulate Xilinx memory
  controller for Series 7.

  The normal leon3 test bench can be executed as the DDR3 model
  is pre-loading with the systest. A model of the DDR3 interface
  exist and can be used for faster simulations and software debug

* The application UART1 is connected to the USB/RS232 connector

* The JTAG DSU interface is enabled and accesible via the JTAG port.
  Start grmon with -xilusb to connect.

* Output from GRMON is:

  grmon -xilusb -u -nb

  GRMON2 LEON debug monitor v2.0.46-12-g452afa7 internal version
  
  Copyright (C) 2013 Aeroflex Gaisler - All rights reserved.
  For latest updates, go to http://www.gaisler.com/
  Comments or bug-reports to support@gaisler.com
  
  This internal version will expire on 28/01/2015

Parsing -xilusb
Parsing -u
Parsing -nb

Commands missing help:
 datacache

Xilusb: Cable type/rev : 0x3 
 JTAG chain (1): xc7a200t 
  GRLIB build version: 4141
  Detected frequency:  100 MHz
  
  Component                            Vendor
  LEON3 SPARC V8 Processor             Aeroflex Gaisler
  AHB Debug UART                       Aeroflex Gaisler
  JTAG Debug Link                      Aeroflex Gaisler
  GR Ethernet MAC                      Aeroflex Gaisler
  AHB/APB Bridge                       Aeroflex Gaisler
  LEON3 Debug Support Unit             Aeroflex Gaisler
  Single-port AHB SRAM module          Aeroflex Gaisler
  Xilinx MIG DDR3 Controller           Aeroflex Gaisler
  Single-port AHB SRAM module          Aeroflex Gaisler
  Generic UART                         Aeroflex Gaisler
  Multi-processor Interrupt Ctrl.      Aeroflex Gaisler
  Modular Timer Unit                   Aeroflex Gaisler
  AMBA Wrapper for OC I2C-master       Aeroflex Gaisler
  General Purpose I/O port             Aeroflex Gaisler
  Gaisler RGMII Interface              Aeroflex Gaisler
  
  Use command 'info sys' to print a detailed report of attached cores

grmon2>
